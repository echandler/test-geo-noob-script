
function brazilCodes(obj){

    obj.GM_addStyle(`
     ._img:hover { width: auto !important; }
     ._divImg:hover { z-index: 1000 !important; }

    `);

        let _data_ = [{"pos":{"lat":-23.542874439295087,"lng":-46.640889860869144},"num":11},{"pos":{"lat":-23.222010762926587,"lng":-45.438881960761854},"num":12},{"pos":{"lat":-24.57794659724267,"lng":-47.636147585761854},"num":13},{"pos":{"lat":-22.480705083622574,"lng":-49.31278643234018},"num":14},{"pos":{"lat":-23.92462693660213,"lng":-48.35697588546518},"num":15},{"pos":{"lat":-21.113834724606875,"lng":-48.25809893234018},"num":16},{"pos":{"lat":-20.549088993403945,"lng":-49.78519854171518},"num":17},{"pos":{"lat":-21.911064104726474,"lng":-51.52103838546518},"num":18},{"pos":{"lat":-22.114772320069637,"lng":-47.34623369796518},"num":19},{"pos":{"lat":-22.883736390088206,"lng":-43.174825675250496},"num":21},{"pos":{"lat":-22.25806785705695,"lng":-41.82517664885884},"num":22},{"pos":{"lat":-22.395264482253697,"lng":-43.86863368010884},"num":24},{"pos":{"lat":-21.132549771700944,"lng":-41.05042478433147},"num":28},{"pos":{"lat":-20.228060057513183,"lng":-40.55604001870647},"num":27},{"pos":{"lat":-19.883547780913972,"lng":-43.97212421160874},"num":31},{"pos":{"lat":-21.287967272666712,"lng":-43.799622715679206},"num":32},{"pos":{"lat":-17.998195387207737,"lng":-41.6084864080513},"num":33},{"pos":{"lat":-19.028797751150634,"lng":-47.8267481268013},"num":34},{"pos":{"lat":-21.74716816965603,"lng":-45.5855371893013},"num":35},{"pos":{"lat":-19.236387053830775,"lng":-45.8931543768013},"num":37},{"pos":{"lat":-16.20192526131874,"lng":-44.4869043768013},"num":38},{"pos":{"lat":-25.43884873727725,"lng":-49.287681447973156},"num":41},{"pos":{"lat":-25.120955123237906,"lng":-51.441001760473156},"num":42},{"pos":{"lat":-23.52927940926478,"lng":-50.649986135473156},"num":43},{"pos":{"lat":-23.549423632574864,"lng":-52.946128713598156},"num":44},{"pos":{"lat":-25.101059162442382,"lng":-54.011802541723156},"num":45},{"pos":{"lat":-25.850787836273653,"lng":-53.330650197973156},"num":46},{"pos":{"lat":-26.886263144374652,"lng":-49.461282374550926},"num":47},{"pos":{"lat":-28.22063158963385,"lng":-49.021829249550926},"num":48},{"pos":{"lat":-27.218928883139487,"lng":-51.241067530800926},"num":49},{"pos":{"lat":-29.911065630761303,"lng":-51.23382810068637},"num":51},{"pos":{"lat":-31.55412576708923,"lng":-52.81585935068637},"num":53},{"pos":{"lat":-28.375861324053268,"lng":-52.11273435068637},"num":54},{"pos":{"lat":-29.127138520764063,"lng":-54.70550778818637},"num":55},{"pos":{"lat":-15.800162528320032,"lng":-47.89581036199103},"num":61},{"pos":{"lat":-14.50646560784001,"lng":-49.98321270574103},"num":62},{"pos":{"lat":-10.258148060901531,"lng":-48.26934551824103},"num":63},{"pos":{"lat":-17.61743877472177,"lng":-50.841532782565},"num":64},{"pos":{"lat":-15.384432258475998,"lng":-57.0644696273558},"num":65},{"pos":{"lat":-12.505890316169774,"lng":-54.1201336898558},"num":66},{"pos":{"lat":-20.455659860343,"lng":-54.611285922517936},"num":67},{"pos":{"lat":-10.76943996346674,"lng":-63.09281100354144},"num":69},{"pos":{"lat":-12.931189430258087,"lng":-38.470548641175796},"num":71},{"pos":{"lat":-15.656331542695654,"lng":-39.305509578675796},"num":73},{"pos":{"lat":-10.537260173191607,"lng":-40.722745906800796},"num":74},{"pos":{"lat":-10.742411464570326,"lng":-38.569425594300796},"num":75},{"pos":{"lat":-13.449225289468,"lng":-43.55869443124104},"num":77},{"pos":{"lat":-10.591260714975357,"lng":-37.18662411874104},"num":79},{"pos":{"lat":-8.030010048514221,"lng":-35.64049076834555},"num":81},{"pos":{"lat":-9.614982786827492,"lng":-36.12388920584555},"num":82},{"pos":{"lat":-7.049802077614197,"lng":-36.06895756522055},"num":83},{"pos":{"lat":-5.663150740057879,"lng":-36.23375248709555},"num":84},{"pos":{"lat":-4.032099198780388,"lng":-38.81553959647055},"num":85},{"pos":{"lat":-4.196469375172888,"lng":-40.69420170584555},"num":86},{"pos":{"lat":-8.258395963684123,"lng":-38.45299076834555},"num":87},{"pos":{"lat":-5.280382126779516,"lng":-39.35386967459555},"num":88},{"pos":{"lat":-7.442150498132251,"lng":-41.77086186209555},"num":89},{"pos":{"lat":-2.924481, "lng": -49.562220 },"num":91},{"pos":{"lat":-3.148852509717535,"lng":-60.13637419377288},"num":92},{"pos":{"lat":-5.514950064103183,"lng":-54.33559294377288},"num":93},{"pos":{"lat":-7.087373284965548,"lng":-50.46840544377288},"num":94},{"pos":{"lat":2.1225130506504946,"lng":-61.23500700627288},"num":95},{"pos":{"lat":1.2439946800133443,"lng":-51.43520231877288},"num":96},{"pos":{"lat":-4.420460977555801,"lng":-65.49770231877288},"num":97}]; 

        let phoneCode = 91; 

        /* Used to make the codes initially
        
        MWGTM_M.addListener("click", doMarker);

        function doMarker(e){
            console.log(e.latLng.lat(),e.latLng.lng());

            let m =  makeNewMarker({lat: e.latLng.lat(),lng: e.latLng.lng()}, phoneCode);

            _data_.push({
                pos:{lat: e.latLng.lat(),lng: e.latLng.lng()},
                num: phoneCode,
            });

            phoneCode++;

            console.log(JSON.stringify(_data_));
         }
          
        */

          function makeNewMarker(latLng, phoneCode){
            let marker = makeMarker(MWGTM_M, phoneCode);

            marker.phoneCode = phoneCode;

            marker._setPos(latLng);

            marker._infowindow._setContent(`<div style="color:black">${phoneCode}</div>`);

            marker.addListener("dragend", (event) => {
                const position = marker.position;

               _data_.forEach(x =>{
                   if (x.num !== marker.phoneCode) return;

                   x.pos.lat = position.lat();
                   x.pos.lng = position.lng();

                   console.log(JSON.stringify(_data_));
               });
           });

          return marker;
        };

         function makeMarker(_this, content) { 
            let marker = new google.maps.Marker({
                title: "This is a marker",
                draggable:true,
            });

            marker._setPos = function (latLng) {
                marker.setPosition(latLng);
                marker.setMap(_this);
            }

            marker._infowindow = new google.maps.InfoWindow({
                content: '',
                ariaLabel: "Uluru",
                anchor: marker,
                map: _this 
            });

            marker._infowindow._setContent = function (content) {
                marker._infowindow.setContent(content);
                setTimeout(() => {
                    let d = document.querySelector("[aria-label='Close']");
                    if (d) {
                        d.style.display = "none";
                    }
                }, 1000);
            }
            return marker;
        }

        function TxtOverlay(pos, txt, cls,backgroundColor, map) {

            // Now initialize all properties.
            this.pos = pos;
            this.txt_ = txt;
            this.cls_ = cls;
            this.map_ = map;
            this.backgroundColor_ = backgroundColor;

            // We define a property to hold the image's
            // div. We'll actually create this div
            // upon receipt of the add() method so we'll
            // leave it null for now.
            this.div_ = null;

            // Explicitly call setMap() on this overlay
            this.setMap(map);
        }

        TxtOverlay.prototype = new google.maps.OverlayView();

        TxtOverlay.prototype.onAdd = function() {

            // Note: an overlay's receipt of onAdd() indicates that
            // the map's panes are now available for attaching
            // the overlay to the map via the DOM.

            // Create the DIV and set some basic attributes.
            var div = document.createElement('DIV');
            div.className = this.cls_;

            div.innerHTML = this.txt_;

            // Set the overlay's div_ property to this DIV
            this.div_ = div;
            var overlayProjection = this.getProjection();
            var position = overlayProjection.fromLatLngToDivPixel(this.pos);
            
            div.style.cssText = `
                border: 1px solid rgb(200,200,200); 
                color: black; 
                position: absolute;
                background-color: white;
                padding: 5px;
                font-size: 10px;
                translate: -10px -10px;
          `;
           div.style.backgroundColor = this.backgroundColor_;
          // We add an overlay to a map via one of the map's panes.
          var panes = this.getPanes();
          
          // panes.floatPane.appendChild(div);
          panes.overlayLayer.appendChild(div);
        }

        TxtOverlay.prototype.draw = function() {
            var overlayProjection = this.getProjection();

            // Retrieve the southwest and northeast coordinates of this overlay
            // in latlngs and convert them to pixels coordinates.
            // We'll use these coordinates to resize the DIV.
            var position = overlayProjection.fromLatLngToDivPixel(this.pos);


            var div = this.div_;
            //console.log(this.pos.lat(), this.pos.lng(), position);

            div.style.left = position.x + 'px';
            div.style.top = position.y + 'px';
        }
        
        //Optional: helper methods for removing and toggling the text overlay.  
        TxtOverlay.prototype.onRemove = function() {
            this.div_.parentNode.removeChild(this.div_);
            this.div_ = null;
        }

        TxtOverlay.prototype.hide = function() {
            if (this.div_) {
                this.div_.style.visibility = "hidden";
            }
        }

        TxtOverlay.prototype.show = function() {
            if (this.div_) {
                this.div_.style.visibility = "visible";
            }
        }

        TxtOverlay.prototype.toggle = function() {
            if (this.div_) {
                if (this.div_.style.visibility == "hidden") {
                    this.show();
                } else {
                    this.hide();
                }
            }
        }

        TxtOverlay.prototype.toggleDOM = function() {
            if (this.getMap()) {
                this.setMap(null);
            } else {
                this.setMap(this.map_);
            }
        }

        let backgroundColors = [null, "rgb(216 159 207)", "rgb(238 216 149)", "beige", "rgb(14 205 204)", "rgb(105 254 201)", "rgb(255 252 77)", "rgb(255 169 250)","rgb(255 129 130)", "rgb(0 252 85)"];
        let overLays = [];

        function showCodes(){
            _data_.forEach((x)=>{
                let color = backgroundColors[+(x.num+'')[0]];
                txt = new TxtOverlay(x.pos, x.num, "customBox",color, obj.map);
                
                //
                //
                // Enable this to show markers to make adjustments.
                //let m =  makeNewMarker(x.pos, x.num);
                //
                //

                overLays.push(txt);
             });
        } 

        function hideCodes(){
            overLays.forEach((x)=>{
                 x.setMap(null);
             });

            overLays = [];
        } 

        setInterval(()=>{
            let container = document.querySelector("#mwgtm-settings-buttons");
            if (!container) return;    
            if (container && document.querySelector("#brazilPhoneCodes")) return;

            const div = document.createElement('div');
            div.classList.add("mwgtm-settings-option");
            div.id = "brazilPhoneCodes"; 
            div.innerHTML = "Show/Hide Brazil Area Codes";
            div.style.color = "white";
            div.addEventListener('click', ()=>{
                overLays.length? hideCodes(): showCodes();
            });
             
            container.appendChild(div);
        }, 1000);
}
